<!doctype html
<html lang="ar" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØ®ØµØµ Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Almarai:wght@400;700&display=swap');

    :root{
      /* Dark Mode (Default) */
      --bg-main: #0a0e1a;
      --bg-header: linear-gradient(135deg,rgba(6,182,212,0.1),rgba(6,182,212,0.05));
      --card-bg: #131a2b;
      --card-hover: #182033;
      --input-bg: rgba(255,255,255,0.03);
      --input-focus: rgba(255,255,255,0.06);
      --text-primary: #e8f0f8;
      --text-secondary: #9ca3af;
      --accent: #06b6d4;
      --accent-hover: #0891b2;
      --border: rgba(255,255,255,0.06);
      --shadow: rgba(0,0,0,0.4);
      --modal-bg: rgba(0,0,0,0.75);
      --btn-active-text: #042029;
    }
    
    /* --- ğŸ’¡ NEW: Light Mode Colors ğŸ’¡ --- */
    body.light-mode {
      --bg-main: #f4f7fa; /* Light grey background */
      --bg-header: #ffffff; /* White header */
      --card-bg: #ffffff;
      --card-hover: #f9fafb;
      --input-bg: rgba(0,0,0,0.04);
      --input-focus: #ffffff;
      --text-primary: #111827; /* Dark text */
      --text-secondary: #4b5563; /* Medium grey text */
      --accent: #06b6d4;
      --accent-hover: #0891b2;
      --border: rgba(0,0,0,0.1);
      --shadow: rgba(0,0,0,0.05);
      --modal-bg: rgba(0,0,0,0.5);
      --btn-active-text: #ffffff; /* White text on accent */
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Almarai','Segoe UI',Tahoma,sans-serif;
      background: var(--bg-main);
      color:var(--text-primary);
      min-height:100vh;
      line-height:1.6;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .container{max-width:1200px;margin:0 auto;padding:24px}
    
    /* Header */
    header{
      background: var(--bg-header);
      border-radius:16px;
      padding:28px;
      margin-bottom:28px;
      border:1px solid var(--border);
      backdrop-filter:blur(10px);
      transition: all 0.3s ease;
    }
    .header-content{display:flex;gap:20px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{
      font-size:28px;
      font-weight:700;
      /* --- ğŸ’¡ UPDATED: Simpler title color for toggling ğŸ’¡ --- */
      color: var(--text-primary);
    }
    body.light-mode h1 {
      color: var(--accent-hover);
    }
    .subtitle{color:var(--text-secondary);font-size:14px;margin-top:6px}

    /* --- ğŸ’¡ NEW: Theme Toggle Button ğŸ’¡ --- */
    .theme-toggle {
      background: var(--input-bg);
      border: 1px solid var(--border);
      color: var(--text-secondary);
      width: 40px;
      height: 40px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      color: var(--accent);
      border-color: var(--accent);
    }
    .theme-toggle .fa-sun { display: none; }
    .theme-toggle .fa-moon { display: block; }
    body.light-mode .theme-toggle .fa-sun { display: block; }
    body.light-mode .theme-toggle .fa-moon { display: none; }

    
    .header-toolbar {
      display: flex;
      gap: 16px;
      margin-top: 20px;
    }
    .header-toolbar input[type=text] {
      flex: 1;
    }
    .view-toggle {
      display: flex;
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }
    .view-toggle button {
      background: var(--input-bg);
      color: var(--text-secondary);
      border: none;
      padding: 10px 14px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    /* --- ğŸ’¡ UPDATED: LTR border ğŸ’¡ --- */
    .view-toggle button:first-child {
      border-right: 1px solid var(--border); 
    }
    .view-toggle button:hover {
      color: var(--text-primary);
      background: var(--input-focus);
    }
    .view-toggle button.active {
      color: var(--btn-active-text);
      background: var(--accent);
    }

    
    input[type=text]{
      padding:12px 16px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--input-bg);
      color:var(--text-primary);
      width:100%;
      transition:all 0.3s ease;
      font-size:14px;
    }
    input[type=text]:focus{
      outline:none;
      border-color:var(--accent);
      background: var(--input-focus);
      box-shadow:0 0 0 3px rgba(6,182,212,0.1);
    }
    
    .category-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding-top: 16px;
      margin-top: 16px;
      border-top: 1px solid var(--border);
    }
    .category-buttons button {
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 600;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid var(--border);
      background: var(--input-bg);
      color: var(--text-secondary);
      font-family: 'Almarai', sans-serif;
    }
    .category-buttons button:hover {
      background: var(--input-focus);
      border-color: var(--border);
      color: var(--text-primary);
    }
    .category-buttons button.active {
      background: var(--accent);
      color: var(--btn-active-text);
      border-color: var(--accent);
    }
    
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
      gap:20px;
      margin-bottom:40px;
    }
    .card{
      background:var(--card-bg);
      padding:20px;
      border-radius:14px;
      border:1px solid var(--border);
      transition:all 0.3s ease;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      box-shadow: 0 4px 12px var(--shadow);
    }
    .card::before{
      content:'';
      position:absolute;
      top:0;
      /* --- ğŸ’¡ UPDATED: LTR position ğŸ’¡ --- */
      right:0; 
      left: 0;
      height:3px;
      background:linear-gradient(90deg, transparent, var(--accent));
      opacity:0;
      transition:opacity 0.3s ease;
    }
    .card:hover{
      transform:translateY(-4px);
      background:var(--card-hover);
      box-shadow:0 12px 28px var(--shadow);
      border-color:rgba(6,182,212,0.3);
    }
    .card:hover::before{opacity:1}
    
    .card-category {
      position: absolute;
      top: 12px;
      /* --- ğŸ’¡ UPDATED: LTR position ğŸ’¡ --- */
      right: 12px;
      background: rgba(113, 113, 122, 0.2);
      color: var(--text-secondary);
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }
    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:12px;
      padding-top: 24px;
    }
    .code-title{flex:1}
    .code{
      font-weight:700;
      color:var(--accent);
      font-size:15px;
      margin-bottom:4px;
    }
    .course-name{
      font-size:16px;
      font-weight:600;
      color:var(--text-primary);
      line-height:1.4;
    }
    .badge{
      padding:6px 12px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
      white-space:nowrap;
    }
    .badge-success{background:rgba(16,185,129,0.15);color:var(--success)}
    .badge-info{background:rgba(6,182,212,0.15);color:var(--accent)}
    .meta{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      font-size:13px;
      color:var(--text-secondary);
      margin:12px 0;
      padding:12px 0;
      border-top:1px solid var(--border);
      border-bottom:1px solid var(--border);
    }
    .meta-item{display:flex;align-items:center;gap:6px}
    .desc{
      font-size:14px;
      color:var(--text-secondary);
      line-height:1.6;
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      overflow:hidden;
      margin-bottom:12px;
    }
    .prereq{
      font-size:13px;
      padding:8px 12px;
      background:rgba(245,158,11,0.1);
      border-radius:8px;
      color:#fbbf24;
      border:1px solid rgba(245,158,11,0.2);
    }
    .card-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:16px;
    }
    .btn{
      padding:10px 18px;
      border-radius:8px;
      border:none;
      background:var(--accent);
      color: var(--btn-active-text);
      cursor:pointer;
      font-weight:600;
      font-size:14px;
      transition:all 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }
    .btn:hover{
      background:var(--accent-hover);
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(6,182,212,0.3);
    }
    
    
    /* List View Styles */
    .grid.list-view {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .grid.list-view .card {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 16px 20px;
    }
    .grid.list-view .card:hover { transform: none; }
    .grid.list-view .card-category { display: none; }
    .grid.list-view .card-header { flex: 1; margin-bottom: 0; padding-top: 0; }
    .grid.list-view .meta {
      display: flex;
      flex-direction: row;
      gap: 20px;
      border: none;
      padding: 0;
      margin: 0 24px;
      width: auto;
      font-size: 13px;
    }
    .grid.list-view .meta .meta-item:nth-child(2),
    .grid.list-view .meta .meta-item:nth-child(3) {
      display: none;
    }
    .grid.list-view .desc { display: none; }
    .grid.list-view .prereq { display: none; }
    .grid.list-view .card-footer { margin-top: 0; }
    .grid.list-view .card-footer span { display: none; }
    
    @media (max-width: 768px) {
      .grid.list-view .meta { display: none; }
      .grid.list-view .card { padding: 12px 16px; }
      .header-toolbar { flex-wrap: wrap; }
    }
    
    /* Modal */
    .modal-back{
      position:fixed;
      inset:0;
      background: var(--modal-bg);
      backdrop-filter:blur(8px);
      display:none;
      align:items:center;
      justify-content:center;
      padding:20px;
      z-index:1000;
      animation:fadeIn 0.3s ease;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal{
      max-width:700px;
      width:100%;
      background:var(--card-bg);
      border-radius:16px;
      padding:28px;
      border:1px solid var(--border);
      box-shadow:0 20px 60px var(--shadow);
      animation:slideUp 0.3s ease;
      max-height:90vh;
      overflow-y:auto;
    }
    @keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:20px;
      padding-bottom:16px;
      border-bottom:2px solid var(--border);
    }
    .modal h2{
      font-size:22px;
      color:var(--accent);
      margin:0;
      line-height: 1.5;
    }
    .close-btn{
      padding:8px 16px;
      border-radius:8px;
      border:1px solid var(--border);
      background:var(--input-bg);
      color:var(--text-secondary);
      cursor:pointer;
      transition:all 0.3s ease;
      font-size:14px;
    }
    .close-btn:hover{
      background: var(--input-focus);
      color:var(--text-primary);
    }
    
    .modal-content{line-height:1.8;color:var(--text-secondary)}
    
    .modal-meta-toggle {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      margin-top: 12px;
    }
    .modal-meta-toggle strong {
      color: var(--text-primary);
      display: block;
    }
    .modal-meta-toggle a,
    .toggle-link {
      font-size: 13px;
      color: var(--accent);
      cursor: pointer;
      text-decoration: none;
    }
    
    .modal-meta{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
      transition: all 0.3s ease-in-out;
      overflow: hidden;
      max-height: 500px;
    }
    .modal-meta.collapsed {
      max-height: 0;
      gap: 0;
      margin-top: 0;
      margin-bottom: 0;
      opacity: 0;
    }
    
    
    .modal-chip{
      padding:12px;
      background:var(--input-bg);
      border-radius:10px;
      text-align:center;
      font-size:13px;
      border:1px solid var(--border);
    }
    .modal-chip strong{
      color:var(--accent);
      display:block;
      margin-bottom:4px;
      font-size: 14px;
    }
    
    .modal-links-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    footer{
      text-align:center;
      color:var(--text-secondary);
      font-size:14px;
      padding:24px;
      margin-top:40px;
      border-top:1px solid var(--border);
    }
    
    .empty-state{
      text-align:center;
      padding:60px 20px;
      color:var(--text-secondary);
      grid-column: 1 / -1;
    }
    .empty-icon{font-size:48px;margin-bottom:16px;opacity:0.5}
    
    
    @media (max-width:768px){
      .header-content{flex-direction:column;align-items:stretch}
      h1{font-size:22px}
      .modal{padding:20px}
      .modal-meta{grid-template-columns: 1fr;}
      .theme-toggle {
        position: absolute;
        top: 20px;
        /* --- ğŸ’¡ UPDATED: LTR position ğŸ’¡ --- */
        right: 20px; 
      }
      .header-content div:first-child {
        padding-right: 50px; /* Avoid overlap */
      }
    }
  </style>


</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div>
          <h1>IoT - Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡</h1>
          <div class="subtitle"> Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</div>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle light/dark mode">
          <i class="fa-solid fa-sun"></i>
          <i class="fa-solid fa-moon"></i>
        </button>
      </div>
      
      <div class="header-toolbar">
        <div class="view-toggle" id="viewToggle">
          <button class="active" id="viewGridBtn" aria-label="Grid View">
            <i class="fa-solid fa-grip"></i>
          </button>
          <button id="viewListBtn" aria-label="List View">
            <i class="fa-solid fa-bars"></i>
          </button>
        </div>
        <input id="search" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©ØŒ Ø±Ù‚Ù… Ø§Ù„Ù…Ù‚Ø±Ø±ØŒ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ù„ÙˆØµÙ..." />
      </div>
        
      <div class="category-buttons" id="categoryButtons">
        <button data-category="all" class="active">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</button>
        <button data-category="Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ">Ø¬Ø§Ù…Ø¹Ø©</button>
        <button data-category="Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ">ÙƒÙ„ÙŠØ©</button>
        <button data-category="Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø¬Ø¨Ø§Ø±ÙŠ Ø§Ù†ØªØ±Ù†Øª Ø§Ù„Ø§Ø´ÙŠØ§Ø¡">ØªØ®ØµØµ (Ø§Ø¬Ø¨Ø§Ø±ÙŠ)</button>
        <button data-category="Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ">ØªØ®ØµØµ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</button>
        <button data-category="Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø©">Ù…Ø³Ø§Ù†Ø¯</button>
      </div>
    </header>

    <main>
      <div class="grid" id="cards"></div>
      <footer>
        <strong> Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ù‡ÙŠÙ„Ø§Øª</strong><br>
       
      </footer>
    </main>
  </div>

  <div class="modal-back" id="modalBack">
    <div class="modal">
      <div class="modal-header">
        <h2 id="mTitle"></h2>
        <button id="closeModal" class="close-btn">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      
      <div class="modal-content">
      
        <div class="modal-meta-toggle">
            <strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</strong>
            <a href="#" onclick="toggleMeta(event)" class="toggle-link">
                (Ø¥Ø¸Ù‡Ø§Ø±)
            </a>
        </div>
        
        <div class="modal-meta collapsed" id="mMeta"></div>
        
        <div id="mDesc" style="margin-top:20px"></div>
        
        <div id="mLinks" style="margin-top:20px"></div>
      </div>
      
    </div>
  </div>


  <script>
    let courses = [];
    let courseLinks = {};

    const cards = document.getElementById('cards');
    const search = document.getElementById('search');
    const categoryButtons = document.querySelectorAll('#categoryButtons button');
    
    const viewGridBtn = document.getElementById('viewGridBtn');
    const viewListBtn = document.getElementById('viewListBtn');

    function hasPra(c){return c.pra && c.pra !== '-' && c.pra !== ''}

    function render(list){
      cards.innerHTML='';
      if(!list.length){
        cards.innerHTML=`
          <div class="empty-state">
            <div class="empty-icon">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
            <h3>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù‚Ø±Ø±Ø§Øª</h3>
            <p>Ø¬Ø±Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
          </div>
        `;
        return;
      }
      
      list.forEach(c=>{
        const div=document.createElement('div');
        div.className='card';
        div.onclick=()=> window.location.hash = c.code;
        
        const badgeHtml = hasPra(c) 
          ? '<span class="badge badge-info">Ù„Ù‡Ø§ Ù…ØªØ·Ù„Ø¨Ø§Øª</span>'
          : '<span class="badge badge-success">Ø¨Ø¯ÙˆÙ† Ù…ØªØ·Ù„Ø¨</span>';
        
        div.innerHTML=`
          <span class="card-category">${escapeHtml(c.category)}</span>
          <div class="card-header">
            <div class="code-title">
              <div class="code">${escapeHtml(c.code)}</div>
              <div class="course-name">${escapeHtml(c.name)}</div>
            </div>
            ${badgeHtml}
          </div>
          <div class="meta">
            <div class="meta-item"><span>${c.credit} Ø³Ø§Ø¹Ø© Ù…Ø¹ØªÙ…Ø¯Ø©</span></div>
            <div class="meta-item"><span>${c.practical >= 0 ? c.practical + ' Ø¹Ù…Ù„ÙŠ' : 'N/A'}</span></div>
            <div class="meta-item"><span>${c.th_hours >= 0 ? c.th_hours + ' Ù†Ø¸Ø±ÙŠ' : 'N/A'}</span></div>
          </div>
          <div class="desc">${escapeHtml(c.desc)}</div>
          ${hasPra(c) ? `<div class="prereq">Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª: ${escapeHtml(c.pra)}</div>` : ''}
          <div class="card-footer">
            <span style="font-size:13px;color:var(--text-secondary)">Ø§Ù†Ù‚Ø± Ù„Ù„ØªÙØ§ØµÙŠÙ„</span>
            <button class="btn" onclick="event.stopPropagation(); window.location.hash = '${c.code}'">Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</button>
          </div>
        `;
        cards.appendChild(div);
      });
    }

    function escapeHtml(s){
      if (!s) return '';
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function applyFilters(){
      if (courses.length === 0) {
        return;
      }

      const q = search.value.trim().toLowerCase();
      
      const activeCategoryButton = document.querySelector('#categoryButtons button.active');
      const category = activeCategoryButton ? activeCategoryButton.dataset.category : 'all';
      
      let res = courses.filter(c=>{
        const concat = `${c.code} ${c.name} ${c.desc} ${c.pra}`.toLowerCase();
        return concat.includes(q);
      });
      
      if (category !== 'all') {
        res = res.filter(c => c.category === category);
      }
      
      render(res);
    }

    // Event listeners
    search.addEventListener('input', applyFilters);
    
    categoryButtons.forEach(button => {
      button.addEventListener('click', () => {
        categoryButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        applyFilters();
      });
    });

    viewGridBtn.addEventListener('click', () => {
      cards.classList.remove('list-view');
      viewGridBtn.classList.add('active');
      viewListBtn.classList.remove('active');
    });
    
    viewListBtn.addEventListener('click', () => {
      cards.classList.add('list-view');
      viewListBtn.classList.add('active');
      viewGridBtn.classList.remove('active');
    });

    // --- Modal Logic ---
    const modalBack = document.getElementById('modalBack');
    const mTitle = document.getElementById('mTitle');
    const mMeta = document.getElementById('mMeta');
    const mDesc = document.getElementById('mDesc');
    const mLinks = document.getElementById('mLinks');
    
    document.getElementById('closeModal').addEventListener('click', ()=> window.location.hash = '');
    modalBack.addEventListener('click', (e)=>{
      if(e.target === modalBack) window.location.hash = '';
    });

    function toggleMeta(event) {
        event.preventDefault();
        const metaList = document.getElementById('mMeta');
        const link = event.target;
        
        if (metaList) {
            const isCollapsed = metaList.classList.toggle('collapsed');
            link.textContent = isCollapsed ? '(Ø¥Ø¸Ù‡Ø§Ø±)' : '(Ø¥Ø®ÙØ§Ø¡)';
        }
    }

    function toggleTopics(event) {
        event.preventDefault();
        const topicsList = document.getElementById('modal-topics-list');
        const link = event.target;
        
        if (topicsList) {
            const isHidden = topicsList.style.display === 'none';
            topicsList.style.display = isHidden ? 'block' : 'none';
            link.textContent = isHidden ? '(Ø¥Ø®ÙØ§Ø¡)' : '(Ø¥Ø¸Ù‡Ø§Ø±)';
        }
    }

    function createDescriptionSummary(desc) {
        const description = desc || '';
        const engNameMatch = description.match(/English Name:\s*([^.]+)\.?/);
        const engName = engNameMatch ? escapeHtml(engNameMatch[1].trim()) : '';
        let summaryHtml = '';
        if (engName) {
            summaryHtml += `<strong style="color: var(--text-primary); display: block; margin-bottom: 8px;">English Name:</strong> ${engName}`;
        }
        let topicsPart = description;
        if (engNameMatch) {
            topicsPart = description.substring(engNameMatch[0].length).trim();
        } else if (description.startsWith(engName) && engName) {
            topicsPart = '';
        }
        const topics = topicsPart.split(/[.,;]\s+/)
            .map(s => s.trim().replace(/[.,;]$/, ''))
            .filter(s => s.length > 3); 
        if (topics.length > 0) {
            summaryHtml += `
                <div class="modal-meta-toggle">
                    <strong style="color: var(--text-primary); display: block;">Key Topics:</strong>
                    <a href="#" onclick="toggleTopics(event)" class="toggle-link">
                        (Ø¥Ø¸Ù‡Ø§Ø±)
                    </a>
                </div>
            `;
            /* --- ğŸ’¡ UPDATED: LTR styles ğŸ’¡ --- */
            summaryHtml += `<ul id="modal-topics-list" style="padding-left: 20px; margin: 0; color: var(--text-secondary); dir: ltr; text-align: left; display: none;">`;
            topics.forEach(topic => {
                summaryHtml += `<li style="margin-bottom: 6px;">${escapeHtml(topic)}</li>`;
            });
            summaryHtml += `</ul>`;

        } else if (!engName) {
            summaryHtml = `<p>${escapeHtml(description)}</p>`;
        } else if (topicsPart.length > 0) {
            summaryHtml += `<p style="margin-top: 16px;">${escapeHtml(topicsPart)}</p>`;
        }
        
        return summaryHtml;
    }


    function openModal(code){
      const c = courses.find(x=>x.code===code);
      if(!c) return;
      
      const metaBox = document.getElementById('mMeta');
      metaBox.classList.add('collapsed');
      const metaToggleLink = metaBox.previousElementSibling.querySelector('.toggle-link');
      if (metaToggleLink) metaToggleLink.textContent = '(Ø¥Ø¸Ù‡Ø§Ø±)';
      
      
      mTitle.textContent = `${c.code} â€” ${c.name}`;
      mMeta.innerHTML = `
        <div class="modal-chip"><strong>Ø§Ù„ÙƒÙˆØ¯</strong>${c.code}</div>
        <div class="modal-chip"><strong>Ø§Ù„ØªØµÙ†ÙŠÙ</strong>${escapeHtml(c.category)}</div>
        <div class="modal-chip"><strong>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</strong>${c.credit}</div>
        <div class="modal-chip"><strong>Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</strong>${c.pra || '-'}</div>
        <div class="modal-chip"><strong>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø¸Ø±ÙŠØ©</strong>${c.th_hours >= 0 ? c.th_hours : 'N/A'}</div>
        <div class="modal-chip"><strong>Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</strong>${c.practical >= 0 ? c.practical : 'N/A'}</div>
      `;
      
      mDesc.innerHTML = createDescriptionSummary(c.desc);
      
      const links = courseLinks[c.code] || [];
      if(Array.isArray(links) && links.length){
        const buttonsHTML = links.map(l => {
          const name = escapeHtml(l.name || 'Ø±Ø§Ø¨Ø·');
          const href = escapeHtml(l.link || '#');
          return `<a href="${href}" target="_blank" rel="noopener noreferrer" class="btn">${name}</a>`;
        }).join('');
        
        mLinks.innerHTML = `
            <h4 style="margin-top: 20px; margin-bottom: 12px; color: var(--text-primary);">Ø±ÙˆØ§Ø¨Ø· Ù…Ù‡Ù…Ø©</h4>
            <div class="modal-links-container">
                ${buttonsHTML}
            </div>
        `;
      } else {
        mLinks.innerHTML = '';
      }
    }

    function handleHashChange() {
        const code = decodeURIComponent(window.location.hash.substring(1));
        if (courses.length === 0) {
            return;
        }
        const course = courses.find(x => x.code === code);
        if (course) {
            openModal(course.code);
            modalBack.style.display = 'flex';
        } else {
            modalBack.style.display = 'none';
        }
    }

    window.addEventListener('hashchange', handleHashChange);

    // --- ğŸ’¡ NEW: Theme Toggle Logic ğŸ’¡ ---
    const themeToggle = document.getElementById('themeToggle');
    // Check for saved theme in localStorage
    if (localStorage.getItem('theme') === 'light') {
        document.body.classList.add('light-mode');
    }
    
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      // Save preference
      if (document.body.classList.contains('light-mode')) {
        localStorage.setItem('theme', 'light');
      } else {
        localStorage.setItem('theme', 'dark');
      }
    });

    // --- Initialization Logic ---
    async function initializeApp() {
        try {
            const coursesResponse = await fetch('courses.json');
            if (!coursesResponse.ok) {
                throw new Error(`HTTP error! status: ${coursesResponse.status} (courses.json)`);
            }
            courses = await coursesResponse.json();
            console.log("Courses loaded successfully.");

            const courseCategories = {
              "AEL101": "Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "AAL101": "Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CD 101": "Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "IEC101": "Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "AEL102": "Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "NE101": "Ù…ØªØ·Ù„Ø¨ Ø¬Ø§Ù…Ø¹Ø© Ø§Ø¬Ø¨Ø§Ø±ÙŠ",
              "CS 122": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CS 123": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CS 222": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CS 223": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CS 241": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CS 242": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ", "CS 103": "Ù…ØªØ·Ù„Ø¨ ÙƒÙ„ÙŠØ© Ø§Ø¬Ø¨Ø§Ø±ÙŠ",
              "IOT 361": "Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø©", "IOT 261": "Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ®ØµØµ Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø©",
              "IOT 442": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ", "IOT 447": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ", "IOT 455": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ", "IOT 456": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ", "IOT 457": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ", "IOT 458": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ", "IOT 459": "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø®ØªÙŠØ§Ø±ÙŠ"
            };
            const defaultCategory = "Ù…ØªØ·Ù„Ø¨ ØªØ®ØµØµ Ø§Ø¬Ø¨Ø§Ø±ÙŠ Ø§Ù†ØªØ±Ù†Øª Ø§Ù„Ø§Ø´ÙŠØ§Ø¡";

            courses.forEach(c => {
              c.category = courseCategories[c.code] || defaultCategory;
            });

            const linksResponse = await fetch('course_links.json');
            if (!linksResponse.ok) {
                console.warn(`Could not load course_links.json. Status: ${linksResponse.status}`);
                courseLinks = {};
            } else {
                courseLinks = await linksResponse.json();
                console.log("Course links loaded successfully.");
            }

        } catch (error) {
            console.error("Could not load initial data:", error);
            cards.innerHTML = `
              <div class="empty-state">
                <div class="empty-icon">âš ï¸</div>
                <h3>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <p>Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.</p>
              </div>`;
        } finally {
            applyFilters();
            handleHashChange();
        }
    }

    initializeApp();

  </script>
  </body>
</html>