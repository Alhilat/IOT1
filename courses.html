<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>تخصص إنترنت الأشياء</title>
  <style>
    :root{
      --bg-dark:#0a0e1a;
      --bg-medium:#0f1724;
      --card-bg:#131a2b;
      --card-hover:#182033;
      --text-primary:#e8f0f8;
      --text-secondary:#9ca3af;
      --accent:#06b6d4;
      --accent-hover:#0891b2;
      --success:#10b981;
      --warning:#f59e0b;
      --border:rgba(255,255,255,0.06);
      --shadow:rgba(0,0,0,0.4);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Almarai,'Segoe UI',Tahoma,sans-serif;
      background:linear-gradient(135deg,#0a0e1a 0%,#0f1724 50%,#071b2a 100%);
      color:var(--text-primary);
      min-height:100vh;
      line-height:1.6;
    }
    .container{max-width:1200px;margin:0 auto;padding:24px}
    
    /* Header */
    header{
      background:linear-gradient(135deg,rgba(6,182,212,0.1),rgba(6,182,212,0.05));
      border-radius:16px;
      padding:28px;
      margin-bottom:28px;
      border:1px solid var(--border);
      backdrop-filter:blur(10px);
    }
    .header-content{display:flex;gap:20px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{
      font-size:28px;
      font-weight:700;
      background:linear-gradient(135deg,#06b6d4,#0891b2);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .subtitle{color:var(--text-secondary);font-size:14px;margin-top:6px}
    
    /* Controls */
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:20px}
    input[type=text]{
      padding:12px 16px;
      border-radius:10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      color:var(--text-primary);
      min-width:300px;
      flex:1;
      transition:all 0.3s ease;
      font-size:14px;
    }
    input[type=text]:focus{
      outline:none;
      border-color:var(--accent);
      background:rgba(255,255,255,0.06);
      box-shadow:0 0 0 3px rgba(6,182,212,0.1);
    }
    select{
      padding:12px 16px;
      border-radius:10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.03);
      color:var(--text-primary);
      cursor:pointer;
      transition:all 0.3s ease;
      font-size:14px;
    }
    select:hover{background:rgba(255,255,255,0.06)}
    select:focus{outline:none;border-color:var(--accent)}
    
    /* Stats Bar */
    .stats{
      display:flex;
      gap:12px;
      margin-bottom:24px;
      flex-wrap:wrap;
    }
    .stat-card{
      flex:1;
      min-width:140px;
      background:linear-gradient(135deg,rgba(6,182,212,0.08),rgba(6,182,212,0.03));
      padding:16px;
      border-radius:12px;
      border:1px solid var(--border);
      text-align:center;
    }
    .stat-value{font-size:28px;font-weight:700;color:var(--accent)}
    .stat-label{font-size:13px;color:var(--text-secondary);margin-top:4px}
    
    /* Grid */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
      gap:20px;
      margin-bottom:40px;
    }
    .card{
      background:var(--card-bg);
      padding:20px;
      border-radius:14px;
      border:1px solid var(--border);
      transition:all 0.3s ease;
      cursor:pointer;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:3px;
      background:linear-gradient(90deg,var(--accent),transparent);
      opacity:0;
      transition:opacity 0.3s ease;
    }
    .card:hover{
      transform:translateY(-4px);
      background:var(--card-hover);
      box-shadow:0 12px 28px var(--shadow);
      border-color:rgba(6,182,212,0.3);
    }
    .card:hover::before{opacity:1}
    
    .card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
    .code-title{flex:1}
    .code{
      font-weight:700;
      color:var(--accent);
      font-size:15px;
      margin-bottom:4px;
    }
    .course-name{
      font-size:16px;
      font-weight:600;
      color:var(--text-primary);
      line-height:1.4;
    }
    
    .badge{
      padding:6px 12px;
      border-radius:20px;
      font-size:12px;
      font-weight:600;
      white-space:nowrap;
    }
    .badge-success{background:rgba(16,185,129,0.15);color:var(--success)}
    .badge-info{background:rgba(6,182,212,0.15);color:var(--accent)}
    
    .meta{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      font-size:13px;
      color:var(--text-secondary);
      margin:12px 0;
      padding:12px 0;
      border-top:1px solid var(--border);
      border-bottom:1px solid var(--border);
    }
    .meta-item{display:flex;align-items:center;gap:6px}
    .meta-icon{width:16px;height:16px}
    
    .desc{
      font-size:14px;
      color:var(--text-secondary);
      line-height:1.6;
      display:-webkit-box;
      -webkit-line-clamp:3;
      -webkit-box-orient:vertical;
      overflow:hidden;
      margin-bottom:12px;
    }
    
    .prereq{
      font-size:13px;
      padding:8px 12px;
      background:rgba(245,158,11,0.1);
      border-radius:8px;
      color:#fbbf24;
      border:1px solid rgba(245,158,11,0.2);
    }
    
    .card-footer{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:16px;
    }
    .btn{
      padding:10px 18px;
      border-radius:8px;
      border:none;
      background:var(--accent);
      color:#042029;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
      transition:all 0.3s ease;
    }
    .btn:hover{
      background:var(--accent-hover);
      transform:translateY(-2px);
      box-shadow:0 6px 16px rgba(6,182,212,0.3);
    }
    
    /* Modal */
    .modal-back{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.75);
      backdrop-filter:blur(8px);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:1000;
      animation:fadeIn 0.3s ease;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal{
      max-width:700px;
      width:100%;
      background:var(--card-bg);
      border-radius:16px;
      padding:28px;
      border:1px solid var(--border);
      box-shadow:0 20px 60px rgba(0,0,0,0.6);
      animation:slideUp 0.3s ease;
      max-height:90vh;
      overflow-y:auto;
    }
    @keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:20px;
      padding-bottom:16px;
      border-bottom:2px solid var(--border);
    }
    .modal h2{
      font-size:22px;
      color:var(--accent);
      margin:0;
    }
    .close-btn{
      padding:8px 16px;
      border-radius:8px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.05);
      color:var(--text-secondary);
      cursor:pointer;
      transition:all 0.3s ease;
      font-size:14px;
    }
    .close-btn:hover{
      background:rgba(255,255,255,0.1);
      color:var(--text-primary);
    }
    .modal-content{line-height:1.8;color:var(--text-secondary)}
    .modal-meta{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:12px;
      margin:20px 0;
    }
    .modal-chip{
      padding:12px;
      background:rgba(255,255,255,0.04);
      border-radius:10px;
      text-align:center;
      font-size:13px;
      border:1px solid var(--border);
    }
    .modal-chip strong{color:var(--accent);display:block;margin-bottom:4px}
    
    footer{
      text-align:center;
      color:var(--text-secondary);
      font-size:14px;
      padding:24px;
      margin-top:40px;
      border-top:1px solid var(--border);
    }
    
    .empty-state{
      text-align:center;
      padding:60px 20px;
      color:var(--text-secondary);
    }
    .empty-icon{font-size:48px;margin-bottom:16px;opacity:0.5}
    
    
    @media (max-width:768px){
      .header-content{flex-direction:column;align-items:stretch}
      .controls{flex-direction:column}
      input[type=text]{min-width:100%;width:100%}
      .grid{grid-template-columns:1fr}
      h1{font-size:22px}
      .modal{padding:20px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div>
          <h1>IoT - إنترنت الأشياء</h1>
          <div class="subtitle"> المقررات الدراسية</div>
        </div>
      </div>
      <div class="controls">
        <input id="search" type="text" placeholder="ابحث باسم المادة، رقم المقرر، أو كلمة من الوصف..." />
        <select id="filterPra">
          <option value="all">كل المقررات</option>
          <option value="hasPra">لها متطلبات سابقة</option>
          <option value="noPra">بدون متطلبات سابقة</option>
        </select>
        <select id="sortBy">
          <option value="code">ترتيب حسب الكود</option>
          <option value="name">ترتيب حسب الاسم</option>
          <option value="credit">ترتيب حسب الساعات المعتمدة</option>
        </select>
      </div>
    </header>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="totalCourses">0</div>
        <div class="stat-label">إجمالي المقررات</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="displayedCourses">0</div>
        <div class="stat-label">المقررات المعروضة</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalCredits">0</div>
        <div class="stat-label">مجموع الساعات</div>
      </div>
    </div>

    <main>
      <div class="grid" id="cards"></div>
      <footer>
        <strong>المهندس عبدالرحمن الهيلات</strong><br>
       
      </footer>
    </main>
  </div>

  <div class="modal-back" id="modalBack">
    <div class="modal">
      <div class="modal-header">
        <h2 id="mTitle"></h2>
        <button id="closeModal" class="close-btn">إغلاق</button>
      </div>
      <div class="modal-content">
        <div class="modal-meta" id="mMeta"></div>
        <p id="mDesc" style="margin-top:20px"></p>
        <div id="mLinks" style="margin-top:20px"></div>
      </div>
    </div>
  </div>


  <script>
    const courses = [
      {code:"CS 103", name:"Computer Skills", pra:"-", pra_hours:0, practical:2, th_hours:3, credit:2, desc:`Concepts, trends, techniques and applications of E-learning. Concepts and skills related to the setup and use of online collaborative tools, such as storage, productivity, applications, social media, calendar, web meetings, learning environment and mobile technology.`},
      {code:"CS 122", name:"Object Oriented Programming", pra:"CS 103", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Object-oriented (OO) programming environment, OO building blocks, input/output, loops, decisions, functions, arrays and strings, data structures, encapsulation, advanced variables, object oriented programming, classes and objects, inheritance, composition, polymorphism, method overloading, handling exceptions, thread programming and multithreading using Java.`},
      {code:"CS 123", name:"Object Oriented Programming Lab", pra:"CS 122", pra_hours:3, practical:0, th_hours:1, credit:1, desc:`Structured Programming Skills Recap, Object-Oriented Programming (OOP) Skills, Classes And Objects, Access Modifiers, Constructors, Constructor Overloading, Destructors, Using Constant in OOP, Using Static in OOP, Methods and Parameter Passing, Array of Objects, Composition, Inheritance, Abstract Classes, Derived Classes, Interfaces, Method Override, Polymorphism, Working with Files, Exception Handling, OOP and GUI by using Java.`},
      {code:"CS 222", name:"Java Programming", pra:"CS 123", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Introduction to Java, the Java programming environment, variables, primitive data types, expressions, control constructs, strings in Java, arrays and vectors, Hash tables, files and I/O in Java, loops, Java GUI, components, events, layout managers, improved GUI libraries, threads, synchronization, Sockets, writing a server and a client.`},
      {code:"CS 223", name:"Java Programming Lab", pra:"CS 222", pra_hours:3, practical:0, th_hours:1, credit:1, desc:`Introduction to Java, JDK and IDE Installation, Input and Output Statements, Construct Basic Java Program with Class, Control Structures, Methods and Objects, Constructors, Arrays and Array List, Inheritance, Polymorphism, Abstract Classes and Interfaces, Exception Handling, Strings, File Processing, GUI Basics and Layout, Event Driven Programming.`},
      {code:"IOT 211", name:"Data Structures and Algorithms", pra:"CS 122", pra_hours:3, practical:2, th_hours:3, credit:3, desc:`Introduction to data structures, problem specification and program design, analysis, testing, verification, and correctness of algorithms, logical and physical representation of data, data structure operations, linked lists, queues, stacks, searching and sorting, tree data structures, sorting by using Java Language.`},
      {code:"IOT 231", name:"Digital Logic", pra:"CS103", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Numbering systems, Boolean algebra, logic algebra, basic logic gates, minimization of logic functions, combinational logic: adders, subtractors, encoders and decoders, multiplexers and demultiplexers, sequential logic: flip-flops, counters, registers and clocked sequential circuits.`},
      {code:"IOT 322", name:"Internet Applications Programming", pra:"IOT 244", pra_hours:3, practical:2, th_hours:3, credit:3, desc:`Web design using HTML and CSS, HTTP protocol, planning and designing effective web pages; implementing web pages by writing HTML and CSS code; enhancing web pages with page layout techniques, text formatting, graphics, images, and multimedia; producing a functional, multi-page website; Client Server Architecture; HTML5; Introduction to server side language, Front-end Frameworks, MVC methodology, JQuery, Ajax and JSON, Deploying web apps, Web DB systems, Web Security, Search Engine theories.`},
      {code:"IOT 244", name:"Databases Design and Management", pra:"CS 222", pra_hours:3, practical:2, th_hours:3, credit:3, desc:`Basic concepts and terminology, DBMS, three level-schema architecture, entity relationship model, relational model, relational algebra, ER to relational mappings, SQL, functional dependencies and normalization.`},
      {code:"IOT 342", name:"Artificial Intelligence", pra:"IOT 211", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Introduction to AI, propositional and predicate calculus, inference, unification, resolution, search strategies, heuristic search, A*, Min-Max, alpha-beta pruning, planning.`},
      {code:"IOT 332", name:"Introduction To Computer Design", pra:"IOT 231", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Internal structure and operation of modern computer systems, system bus, ALU design, control unit, microprogrammed vs hardwired control, CISC vs RISC, pipelining, cache, interrupts and I/O.`},
      {code:"IOT 331", name:"Fundamentals of Operating Systems", pra:"CS 222", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Basic concepts and mechanisms of modern OS, concurrency, thread management, deadlock, synchronization, scheduling, memory and process management.`},
      {code:"CS 241", name:"Communications and Computer Networks", pra:"CS 122", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`OSI model, TCP/IP, physical/data link/network/transport layers, LAN/WAN, network design, security.`},
      {code:"CS 242", name:"Communications and Computer Networks Lab", pra:"CS 241", pra_hours:3, practical:0, th_hours:3, credit:3, desc:`Practices on OSI, TCP/IP, layers, LAN/WAN architectures, network design and security.`},
      {code:"IOT 344", name:"Fundamentals of Cybersecurity", pra:"IOT 322", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Introduction to computer security, threats, secure programming, authentication, network security, firewalls.`},
      {code:"IOT 343", name:"Applied Software Engineering", pra:"IOT 244", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Principles of software engineering, SDLC, requirements analysis, testing, maintenance, waterfall lifecycle hand-on project.`},
      {code:"IOT 222", name:"Design & Organization of Embedded Systems", pra:"CS 122", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Intro to embedded systems, C programming, Arduino, basic circuits, timers, PWM, servos, ADCs, interrupts, communication protocols, sensors, power management.`},
      {code:"IOT 223", name:"Design & Organization of Embedded Systems Lab", pra:"IOT 222", pra_hours:3, practical:0, th_hours:3, credit:3, desc:`Apply C programming to embedded system design with Arduino, circuits, digital I/O, PWM, ADC, sensors, communication.`},
      {code:"IOT 471", name:"Project-1", pra:"-", pra_hours:-1, practical:-1, th_hours:1, credit:1, desc:`Graduation project - تطبيق المعرفة المكتسبة في خطة الدراسة.`},
      {code:"IOT 472", name:"Project-2", pra:"IOT 471", pra_hours:-1, practical:-1, th_hours:2, credit:2, desc:`متابعة مشروع التخرج.`},
      {code:"IOT 473", name:"Field Training", pra:"-", pra_hours:-1, practical:-1, th_hours:3, credit:3, desc:`تدريب عملي في قطاع تكنولوجيا المعلومات تحت إشراف القسم.`},
      {code:"IOT 442", name:"Machine Learning", pra:"IOT 342", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Introduction to ML, supervised learning, ensembles, neural networks, SVM, clustering, preprocessing, data mining.`},
      {code:"IOT 447", name:"Cloud Computing", pra:"IOT 342", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Cloud concepts, services, delivery models, architecture, risks and benefits, security issues.`},
      {code:"IOT 455", name:"Special Topics in IoT", pra:"-", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`مواضيع متقدمة متغيرة كل سنة بحسب الكادر والطلاب.`},
      {code:"IOT 456", name:"Robotics and Autonomous Systems", pra:"IOT 321", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Robotics intro, microcontrollers, motor principles, communication (Bluetooth, GSM, GPS, Wi-Fi), smart houses, machine vision.`},
      {code:"IOT 114", name:"Discrete Structures and Mathematics", pra:"-", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Logic, proofs, sets, functions, induction, counting, probability, graph theory, trees.`},
      {code:"IOT 361", name:"Principles of Numerical Analysis", pra:"IOT 114", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Numerical root finding, interpolation, integration, differential equations, linear algebra methods.`},
      {code:"IOT 105", name:"Physics for IoT Students", pra:"-", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Vectors, motion, Newton laws, electricity, circuits, magnetic fields, capacitors.`},
      {code:"IOT 106", name:"Physics Lab", pra:"IOT 105", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Measurements, Ohm's law, RC circuits, galvanometer, potentiometer.`},
      {code:"IOT 362", name:"Applied Probability and Statistics", pra:"IOT 114", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Probability, discrete distributions, parameter estimation, simulation.`},
      {code:"IOT 251", name:"Introduction to Internet of Things", pra:"CS 122", pra_hours:0, practical:2, th_hours:2, credit:2, desc:`Fundamental IoT concepts, devices, data collection, networking, cloud computing, risks and opportunities.`},
      {code:"IOT 201", name:"Introduction to Circuits & Electronic Hardware", pra:"IOT 231", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Resistive circuits, electronic switches, logic gates, memories, I/O ports.`},
      {code:"IOT 453", name:"Microcontrollers for IoT Devices", pra:"IOT 222", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Overview of embedded microcontrollers with focus on MSP430 series (mixed-signal, low power).`},
      {code:"IOT 452", name:"Wireless Communications for IoT", pra:"IOT 251, CS 241", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Source/channel coding, wireless channels, NB-IoT communications.`},
      {code:"IOT 321", name:"Programming Embedded Systems", pra:"IOT 222", pra_hours:3, practical:2, th_hours:3, credit:3, desc:`Embedded implementation using synchronous state machines on microcontrollers.`},
      {code:"IOT 333", name:"Embedded Operating Systems", pra:"IOT 331", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Embedded OS as dev environment and embedded application development.`},
      {code:"IOT 451", name:"Introduction to Security of IoT", pra:"IOT 344", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Introductory topics in IoT security with hands-on on devices.`},
      {code:"IOT 352", name:"Sensors for IoT", pra:"IOT 321", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Sensors design and fabrication, smart sensors theory and case studies.`},
      {code:"IOT 351", name:"IoT & Sensor Programming with Python", pra:"IOT 321", pra_hours:6, practical:0, th_hours:3, credit:3, desc:`Python for interacting with sensors and IoT devices.`},
      {code:"IOT 457", name:"Internet of Things Privacy", pra:"IOT 251", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Privacy preserving technologies, data access, and privacy law around personal data.`},
      {code:"IOT 458", name:"Network Protocols for IoT", pra:"IOT 352", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`Network protocols at MAC and network layers for IoT communications.`},
      {code:"IOT 454", name:"Embedded GUI Programming", pra:"IOT 351", pra_hours:0, practical:3, th_hours:3, credit:3, desc:`GUI design for embedded systems: events, components, OOP UI models.`}
    ];

    // روابط لكل مقرر: ضع الاسم والرابط هنا لكل كود مقرر
    const courseLinks = {
      // مثال:
      "IOT 322": [
        { name: "Syllabus", link: "https://wokwi.com/projects/new/esp32" },
         { name: "Course Page", link: "https://example.com/iot322" }
      ],

      "IOT 222": [
        { name: "WOKWI", link: "https://wokwi.com/projects/new/arduino-uno" },
         { name: "Course Page", link: "https://example.com/iot322" }
      ],
    
      
    };

    const cards = document.getElementById('cards');
    const search = document.getElementById('search');
    const filterPra = document.getElementById('filterPra');
    const sortBy = document.getElementById('sortBy');
    const totalCoursesEl = document.getElementById('totalCourses');
    const displayedCoursesEl = document.getElementById('displayedCourses');
    const totalCreditsEl = document.getElementById('totalCredits');


    function hasPra(c){return c.pra && c.pra !== '-' && c.pra !== ''}

    function updateStats(list){
      totalCoursesEl.textContent = courses.length;
      displayedCoursesEl.textContent = list.length;
      const credits = list.reduce((sum, c) => sum + (c.credit > 0 ? c.credit : 0), 0);
      totalCreditsEl.textContent = credits;
    }

    function render(list){
      cards.innerHTML='';
      if(!list.length){
        cards.innerHTML=`
          <div class="empty-state">
            <div class="empty-icon">لا توجد نتائج</div>
            <h3>لم يتم العثور على مقررات</h3>
            <p>جرب تعديل معايير البحث</p>
          </div>
        `;
        return;
      }
      list.forEach(c=>{
        const div=document.createElement('div');
        div.className='card';
        div.onclick=()=>openModal(c.code);
        
        const badgeHtml = hasPra(c) 
          ? '<span class="badge badge-info">لها متطلبات</span>'
          : '<span class="badge badge-success">بدون متطلب</span>';
        
        div.innerHTML=`
          <div class="card-header">
            <div class="code-title">
              <div class="code">${escapeHtml(c.code)}</div>
              <div class="course-name">${escapeHtml(c.name)}</div>
            </div>
            ${badgeHtml}
          </div>
          <div class="meta">
            <div class="meta-item"><span>${c.credit} ساعة معتمدة</span></div>
            <div class="meta-item"><span>${c.practical >= 0 ? c.practical + ' عملي' : 'N/A'}</span></div>
            <div class="meta-item"><span>${c.th_hours >= 0 ? c.th_hours + ' نظري' : 'N/A'}</span></div>
          </div>
          <div class="desc">${escapeHtml(c.desc)}</div>
          ${hasPra(c) ? `<div class="prereq">المتطلبات: ${escapeHtml(c.pra)}</div>` : ''}
          <div class="card-footer">
            <span style="font-size:13px;color:var(--text-secondary)">انقر للتفاصيل</span>
            <button class="btn" onclick="event.stopPropagation();openModal('${c.code}')">عرض التفاصيل</button>
          </div>
        `;
        cards.appendChild(div);
      });
    }

    function escapeHtml(s){
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    function applyFilters(){
      const q=search.value.trim().toLowerCase();
      let res = courses.filter(c=>{
        const concat = `${c.code} ${c.name} ${c.desc} ${c.pra}`.toLowerCase();
        return concat.includes(q);
      });
      
      if(filterPra.value==='hasPra') res = res.filter(hasPra);
      if(filterPra.value==='noPra') res = res.filter(c=>!hasPra(c));
      
      if(sortBy.value==='code') res.sort((a,b)=>a.code.localeCompare(b.code));
      else if(sortBy.value==='name') res.sort((a,b)=>a.name.localeCompare(b.name));
      else if(sortBy.value==='credit') res.sort((a,b)=>b.credit - a.credit);
      
      updateStats(res);
      render(res);
    }

    search.addEventListener('input', applyFilters);
    filterPra.addEventListener('change', applyFilters);
    sortBy.addEventListener('change', applyFilters);

    const modalBack = document.getElementById('modalBack');
    const mTitle = document.getElementById('mTitle');
    const mMeta = document.getElementById('mMeta');
    const mDesc = document.getElementById('mDesc');
    const mLinks = document.getElementById('mLinks');
    
    document.getElementById('closeModal').addEventListener('click', ()=>modalBack.style.display='none');
    modalBack.addEventListener('click', (e)=>{
      if(e.target === modalBack) modalBack.style.display='none';
    });

    function openModal(code){
      const c = courses.find(x=>x.code===code);
      if(!c) return;
      
      mTitle.textContent = `${c.code} — ${c.name}`;
      
      mMeta.innerHTML = `
        <div class="modal-chip"><strong>الكود</strong>${c.code}</div>
        <div class="modal-chip"><strong>الساعات المعتمدة</strong>${c.credit}</div>
        <div class="modal-chip"><strong>الساعات النظرية</strong>${c.th_hours >= 0 ? c.th_hours : 'N/A'}</div>
        <div class="modal-chip"><strong>الساعات العملية</strong>${c.practical >= 0 ? c.practical : 'N/A'}</div>
        <div class="modal-chip"><strong>المتطلبات السابقة</strong>${c.pra || '-'}</div>
      `;
      
      mDesc.textContent = c.desc;
      const links = courseLinks[c.code] || [];
      if(Array.isArray(links) && links.length){
        const list = links.map(l => {
          const n = escapeHtml(l.name || 'رابط');
          const href = escapeHtml(l.link || '#');
          return `<li style=\"margin-bottom:6px\"><a href=\"${href}\" target=\"_blank\" rel=\"noopener noreferrer\" style=\"color:var(--accent)\">${n}</a></li>`;
        }).join('');
        mLinks.innerHTML = `<h4 style=\"margin:12px 0\">روابط مهمة</h4><ul style=\"padding-right:18px\">${list}</ul>`;
      } else {
        mLinks.innerHTML = '';
      }
      modalBack.style.display='flex';
    }


    applyFilters();
  </script>
</body>
</html>